{ 
    "AWSTemplateFormatVersion":"2010-09-09",
    "Description":"This template shows how to use AWS CodePipeline and AWS CodeBuild to build an automated continuous deployment pipeline to Amazon Elastic Container Service (Amazon ECS) using clusters powered by AWS Fargate or Amazon Elastic Compute Cloud (Amazon EC2).\n",
    "Parameters":{ 
       "NameTag":{ 
          "Description":"The Name Tag used for the resources to be created.",
          "Type":"String",
          "Default":"DKW"
       },
       "Environment":{ 
          "Description":"The Environment Type",
          "Type":"String",
          "Default":"DEV"
       },
       "AZ1":{ 
          "Type":"AWS::EC2::AvailabilityZone::Name"
       },
       "AZ2":{ 
          "Type":"AWS::EC2::AvailabilityZone::Name"
       }
    },
    "Resources":{ 
       "VPC":{ 
          "Type":"AWS::CloudFormation::Stack",
          "Properties":{ 
             "TemplateURL":"https://s3.amazonaws.com/dkw-nested-bucket/VPC.json",
             "Parameters":{ 
                "NameTag":{ 
                   "Ref":"NameTag"
                },
                "Environment":{ 
                   "Ref":"Environment"
                },
                "AZ1":{ 
                   "Ref":"AZ1"
                },
                "AZ2":{ 
                   "Ref":"AZ2"
                }
             }
          }
       },
       "SG":{ 
          "Type":"AWS::CloudFormation::Stack",
          "Properties":{ 
             "TemplateURL":"https://s3.amazonaws.com/dkw-nested-bucket/SG.json",
             "Parameters":{ 
                "NameTag":{ 
                   "Ref":"NameTag"
                },
                "Environment":{ 
                   "Ref":"Environment"
                },
                "VPC":{ 
                   "Fn::GetAtt":[ 
                      "VPC",
                      "Outputs.VpcId"
                   ]
                }
             }
          }
       },
       "ALB":{ 
          "Type":"AWS::CloudFormation::Stack",
          "Properties":{ 
             "TemplateURL":"https://s3.amazonaws.com/dkw-nested-bucket/ALB.json",
             "Parameters":{ 
                "NameTag":{ 
                   "Ref":"NameTag"
                },
                "Environment":{ 
                   "Ref":"Environment"
                },
                "VPC":{ 
                   "Fn::GetAtt":[ 
                      "VPC",
                      "Outputs.VpcId"
                   ]
                },
                "PublicSubnet1":{ 
                   "Fn::GetAtt":[ 
                      "VPC",
                      "Outputs.PublicSubnet1"
                   ]
                },
                "PublicSubnet2":{ 
                   "Fn::GetAtt":[ 
                      "VPC",
                      "Outputs.PublicSubnet2"
                   ]
                },
                "WEBALBSecurityGroup":{ 
                   "Fn::GetAtt":[ 
                      "SG",
                      "Outputs.WEBALBSecurityGroup"
                   ]
                },
                "APIALBSecurityGroup":{ 
                   "Fn::GetAtt":[ 
                      "SG",
                      "Outputs.APIALBSecurityGroup"
                   ]
                }
             }
          }
       },
       "Cluster":{ 
          "Type":"AWS::CloudFormation::Stack",
          "Properties":{ 
             "TemplateURL":"https://s3.amazonaws.com/dkw-nested-bucket/Cluster.json",
             "Parameters":{ 
                "NameTag":{ 
                   "Ref":"NameTag"
                },
                "Environment":{ 
                   "Ref":"Environment"
                }
             }
          }
       }
    }
 }